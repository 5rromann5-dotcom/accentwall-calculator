<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">

<style>
    body {
        margin: 0;
        font-family: "Inter", sans-serif;
        background: #f7f7f7;
        height: 100vh;
        display: flex;
        flex-direction: column;
        overflow: hidden;
    }

    /* ---------- TOP BAR ---------- */
    .topbar {
        width: 100%;
        background: white;
        height: 90px;
        box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        display: flex;
        align-items: center;
        justify-content: space-between;
        padding: 0 40px;
        position: fixed;
        top: 0;
        left: 0;
        z-index: 50;
    }

    .topbar-left {
        display: flex;
        align-items: center;
        gap: 14px;
        width: 250px;
    }

    .topbar-left img { height: 55px; }

    .brand-text {
        font-weight: 700;
        font-size: 18px;
        line-height: 1.2;
    }

    .brand-tagline {
        font-size: 14px;
        opacity: 0.7;
        font-weight: 500;
    }

    .topbar-center {
        flex: 1;
        text-align: center;
        font-size: 28px;
        font-weight: 800;
    }

    .topbar-right { width: 250px; }


    /* ---------- MAIN CONTENT ---------- */
    .scroll-area {
        flex: 1;
        overflow-y: auto;
        padding: 130px 0 140px;
        display: flex;
        justify-content: center;
    }

    .content-card {
        width: 900px;
        background: white;
        padding: 40px 60px 80px;
        border-radius: 22px;
        box-shadow: 0 8px 25px rgba(0,0,0,0.08);
        margin-bottom: 40px;
        min-height: 900px;
    }

    /* ----- GRID (2 in row) ------ */
    .grid {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 32px;
        margin-top: 20px;
    }

    .tile {
        border: 2px solid #ddd;
        border-radius: 16px;
        padding: 22px;
        cursor: pointer;
        transition: 0.2s;
        background: #fafafa;
        text-align: center;
        position: relative;
    }

    .tile:hover {
        border-color: #222;
        transform: translateY(-3px);
    }

    .tile.selected {
        border-color: #4A5F3A;
        box-shadow: 0 0 10px rgba(0,0,0,0.15);
    }

    .tile-title {
        font-size: 22px;
        font-weight: 600;
        margin-bottom: 8px;
    }

    .tip-icon {
        font-size: 20px;
        width: 26px;
        height: 26px;
        border-radius: 50%;
        background: #eee;
        border: 1px solid #ccc;
        display: inline-flex;
        align-items: center;
        justify-content: center;
        cursor: pointer;
        margin-top: 8px;
    }
.step-title {
    font-size: 26px;
    font-weight: 700;
    text-align: center;
    margin-bottom: 30px;
}
.tile.disabled {
    opacity: 0.35;
    pointer-events: none;
    filter: grayscale(100%);
}

    /* ---------- BOTTOM BAR ---------- */
    .bottombar {
        width: 100%;
        height: 110px;
        background: white;
        box-shadow: 0 -2px 12px rgba(0,0,0,0.08);
        position: fixed;
        bottom: 0;
        left: 0;
        z-index: 50;
        padding: 10px 40px 0;
    }

    .bottom-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        height: 50px;
    }

    .bottom-btn {
        padding: 12px 26px;
        background: #111;
        color: white;
        border-radius: 14px;
        font-size: 20px;
        font-weight: 600;
        cursor: pointer;
    }

    .bottom-btn.disabled {
        opacity: 0.3;
        pointer-events: none;
    }

    #nextBtn {
        margin-right: 120px;
    }

    .bottom-price {
        font-size: 26px;
        font-weight: 700;
    }

    .progressbar {
        width: 100%;
        height: 6px;
        background: #e5e5e5;
        border-radius: 4px;
        margin-top: 10px;
        overflow: hidden;
    }

    .progressbar-fill {
        height: 100%;
        width: 60%;          /* шаг 4 ≈ 60% прогресса */
        background: #4A5F3A;
    }

    /* ---- FULLSCREEN IMAGE TOOLTIP ---- */
    .tooltip-backdrop {
        position: fixed;
        inset: 0;
        background: rgba(0,0,0,0.35);
        display: none;
        z-index: 9998;
    }

    .tooltip-box {
        position: fixed;
        top: 50%;
        left: 50%;
        transform: translate(-50%, -50%);
        width: 420px;
        max-width: 90vw;

        background: white;
        padding: 18px;
        border-radius: 16px;
        border: 1px solid #ddd;
        box-shadow: 0 10px 35px rgba(0,0,0,0.25);

        display: none;
        opacity: 0;
        transition: opacity 0.25s ease;

        z-index: 9999;
    }

    .tooltip-box.show {
        display: block;
        opacity: 1;
    }

    .tooltip-box img {
        width: 100%;
        border-radius: 12px;
        display: block;
    }
</style>
</head>

<body>

<!-- TOPBAR -->
<div class="topbar">
    <div class="topbar-left">
        <img src="img/LOGO.png">
        <div class="brand-text">
            Accent Wall Calculator<br>
            <span class="brand-tagline">Modern Design • Professional Installation</span>
        </div>
    </div>

    <div class="topbar-center">FINISH OPTIONS</div>

    <div class="topbar-right"></div>
</div>


<!-- MAIN CONTENT -->
<div class="scroll-area">
<div class="content-card">


    <h2 class="step-title">
        How would you like your accent wall finished?
    </h2>



    <div class="grid">
        <div class="tile" onclick="selectFinish('onecolor', event)">
            <div class="tile-title">Paint — One Color</div>
            <div class="tip-icon" onclick="showTip(event, 'onecolor')">?</div>
        </div>

        <div class="tile" onclick="selectFinish('multicolor', event)">
            <div class="tile-title">Paint — Multiple Colors</div>
            <div class="tip-icon" onclick="showTip(event, 'multicolor')">?</div>
        </div>

        <div class="tile" onclick="selectFinish('partial', event)">
            <div class="tile-title">Paint — Partial Colors</div>
            <div class="tip-icon" onclick="showTip(event, 'partial')">?</div>
        </div>

        <div class="tile" onclick="selectFinish('solid_paint', event)">
            <div class="tile-title">Solid Wood + Paint</div>
            <div class="tip-icon" onclick="showTip(event, 'solid_paint')">?</div>
        </div>

        <div class="tile" data-finish="solid_no" onclick="selectFinish('solid_no', event)">

            <div class="tile-title">Solid Wood (No Paint)</div>
            <div class="tip-icon" onclick="showTip(event, 'solid_no')">?</div>
        </div>
    </div>

</div>
</div>


<!-- BOTTOM BAR -->
<div class="bottombar">
    <div class="bottom-row">
        <div class="bottom-btn" onclick="goBack()">Back</div>
        <div class="bottom-price" id="priceBox">$0.00</div>
        <div class="bottom-btn disabled" id="nextBtn">Continue</div>
    </div>

    <div class="progressbar">
        <div class="progressbar-fill"></div>
    </div>
</div>

<!-- MODAL TOOLTIP -->
<div id="tooltipBackdrop" class="tooltip-backdrop"></div>

<div id="tooltipBox" class="tooltip-box">
    <img id="tooltipImage" src="">
</div>

<script>
/* ===== FINISH RATES ===== */
const FINISH_RATE = {
    onecolor:    0.00,
    multicolor:  0.50,
    partial:     0.30,
    solid_paint: 2.00,
    solid_no:    1.50
};

/* ===== URL PARAMS ===== */
const params = new URLSearchParams(window.location.search);
const area   = parseFloat(params.get("area"));
const design = params.get("design");
const variant = params.get("variant");
const prep   = params.get("prep");
const previousPrice = parseFloat(params.get("price"));
const zip = params.get("zip");  

/* ===== DISABLE FINISH OPTIONS BASED ON DESIGN ===== */
function applyFinishRestrictions() {

    // дизайны, где нельзя Solid Wood (No Paint)
    const restrictedDesigns = ["board_batten", "modern_geometric"];

    if (!design) return;

    if (restrictedDesigns.includes(design)) {
        const solidNoTile = document.querySelector(
            '.tile[data-finish="solid_no"]'
        );

        if (solidNoTile) {
            solidNoTile.classList.add("disabled");
        }
    }
}

// применяем сразу при загрузке
applyFinishRestrictions();

// показать цену из шага 3
document.getElementById("priceBox").textContent = "$" + previousPrice.toFixed(2);

let selected = null;

/* ===== PRICE UPDATE ===== */
function updatePrice() {
    if (!selected) return;
    const added = area * FINISH_RATE[selected];
    const newPrice = previousPrice + added;
    document.getElementById("priceBox").textContent = "$" + newPrice.toFixed(2);
}

/* ===== SELECT FINISH ===== */
function selectFinish(type, e) {
    selected = type;

    document.querySelectorAll(".tile").forEach(btn =>
        btn.classList.remove("selected")
    );

    e.currentTarget.classList.add("selected");
    document.getElementById("nextBtn").classList.remove("disabled");
    updatePrice();
}

/* ===== TOOLTIP (image) ===== */
function showTip(event, type) {
    event.stopPropagation(); // не триггерим selectFinish

    const box = document.getElementById("tooltipBox");
    const img = document.getElementById("tooltipImage");
    const backdrop = document.getElementById("tooltipBackdrop");

    // имена файлов: finish_onecolor.jpg, finish_multicolor.jpg и т.д.
   img.src = "img/finish_" + type + ".jpg";


    box.classList.add("show");
    backdrop.style.display = "block";

    backdrop.onclick = closeTip;
    box.onclick = (e) => e.stopPropagation();
}

function closeTip() {
    const box = document.getElementById("tooltipBox");
    const backdrop = document.getElementById("tooltipBackdrop");

    box.classList.remove("show");
    setTimeout(() => { backdrop.style.display = "none"; }, 250);
}

/* ===== NAVIGATION ===== */
/* ===== NAVIGATION ===== */
document.getElementById("nextBtn").onclick = () => {
    if (!selected) return;

    const finalPrice = parseFloat(
        document.getElementById("priceBox").textContent.replace("$", "")
    );

    let paintMode = "";
    switch (selected) {
        case "onecolor": paintMode = "one"; break;
        case "multicolor": paintMode = "multi"; break;
        case "partial": paintMode = "partial"; break;
        case "solid_paint": paintMode = "wood_paint"; break;
        case "solid_no": paintMode = "wood"; break;
    }

    // ПРАВИЛЬНО: не переопределяем zip
    const zipParam = params.get("zip") || "";
    const surcharge = params.get("surcharge") || 0;

    // --- Solid Wood (No Paint) → сразу step6 ---
    if (paintMode === "wood") {
        window.location.href =
            `step6.html?design=${design}` +
            `&variant=${variant}` +
            `&prep=${prep}` +
            `&paint_mode=${paintMode}` +
            `&area=${area}` +
            `&price=${finalPrice}` +
            `&zip=${zipParam}` +
            `&surcharge=${surcharge}`;
        return;
    }

    // --- Остальные режимы → step4_1 ---
    window.location.href =
        `step4_1.html?design=${design}` +
        `&variant=${variant}` +
        `&prep=${prep}` +
        `&paint_mode=${paintMode}` +
        `&area=${area}` +
        `&price=${finalPrice}` +
        `&zip=${zipParam}` +
        `&surcharge=${surcharge}`;
};


function goBack() {
  // Закрываем tooltip, если вдруг открыт
  closeTip();

  // Возвращаемся на шаг 3, сохраняя все параметры
  const qs = window.location.search || "";
  window.location.href = "step3.html" + qs;
}


</script>

</body>
</html>
